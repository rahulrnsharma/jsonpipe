<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JSON Formatter</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'SF Mono', Menlo, Monaco, Consolas, monospace;
      background:#f8f9fa;
      color:#212529;
      height:100vh;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    header {
      background:white;
      border-bottom:1px solid #dee2e6;
      padding:10px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-shrink:0;
    }
    h1 { font-size:17px; font-weight:600; color:#343a40; }
    .btn {
      padding:7px 16px;
      font-size:13px;
      font-weight:500;
      border-radius:6px;
      border:none;
      cursor:pointer;
      transition:all 0.13s;
    }
    .btn-clear { background:#e9ecef; color:#495057; }
    .btn-clear:hover { background:#dee2e6; }
    .btn-copy { background:#4fc3f7; color:white; }
    .btn-copy:hover { background:#29b6f6; }
    .main { flex:1; display:flex; overflow:hidden; }
    .side { flex:1; display:flex; flex-direction:column; min-width:0; }
    .side.left { border-right:1px solid #dee2e6; }
    .header-bar {
      padding:6px 12px;
      background:#f1f3f5;
      border-bottom:1px solid #dee2e6;
      font-size:11px;
      font-weight:600;
      color:#6c757d;
      text-transform:uppercase;
      letter-spacing:0.4px;
    }
    .editor-area, .preview-area {
      flex:1;
      position:relative;
      overflow:hidden;
    }
    .gutter {
      position:absolute;
      left:0; top:0; bottom:0;
      width:44px;
      background:#f8f9fa;
      border-right:1px solid #dee2e6;
      color:#adb5bd;
      font-size:12px;
      text-align:right;
      padding-top:4px;
      line-height:1.55;
      user-select:none;
      pointer-events:none;
      overflow:hidden;
    }
    textarea#jsonInput {
      position:absolute;
      inset:0 0 0 44px;
      width:calc(100% - 44px);
      height:100%;
      padding:4px 12px;
      font-size:13.5px;
      line-height:1.55;
      border:none;
      outline:none;
      resize:none;
      background:white;
      tab-size:2;
      white-space:pre;
      overflow-x:auto;
    }
    #preview {
      position:absolute;
      inset:0 0 0 44px;
      width:calc(100% - 44px);
      height:100%;
      padding:4px 12px;
      font-size:13.5px;
      line-height:1.55;
      overflow:auto;
      background:white;
    }
    .node {
      white-space: pre;
      display: flex;
      flex-direction: column;
    }
    .node.collapsed > .node-children { display: none; }
    .header-row {
      display: flex;
      align-items: baseline;
      flex-wrap: nowrap;
      gap: 3px;
    }
    .toggle {
      display: inline-block;
      width: 1.1em;
      text-align: center;
      color: #495057;
      cursor: pointer;
      user-select: none;
      font-size: 0.95em;
    }
    .toggle:hover { color: #060707; }
    .key     { color: #6e2e81; font-weight: 600; }
    .string  { color: #579f23 }
    .number  { color: #d04551; }
    .boolean { color: #387fb8; font-weight: 600; }
    .null    { color: #d08239; font-style: italic; }
    .brace   { color: #262f2f; font-weight: bold; }
    .ellipsis { color: #858585; }
    .comma   { color: #7f8c8d; margin-left: 2px; }
    .children { margin-left: 1.8em; }
    .empty, .error-msg {
      color: #6c757d;
      font-size: 14px;
    }
    .error-msg { color: #dc3545; background: #fff5f5; }
  </style>
</head>
<body>

<header>
  <h1>JSON Formatter</h1>
  <div>
    <button class="btn btn-clear" id="clearBtn">Clear</button>
    <button class="btn btn-copy" id="copyBtn">Copy Preview</button>
  </div>
</header>

<div class="main">
  <div class="side left">
    <div class="header-bar">INPUT</div>
    <div class="editor-area">
      <div class="gutter" id="inputLines"></div>
      <textarea id="jsonInput" spellcheck="false" placeholder="Paste your JSON here..."></textarea>
    </div>
  </div>

  <div class="side">
    <div class="header-bar">PREVIEW</div>
    <div class="preview-area">
      <div class="gutter" id="previewLines"></div>
      <div id="preview">
        <div class="empty">Paste JSON to see formatted preview</div>
      </div>
    </div>
  </div>
</div>

<script>
// ────────────────────────────────────────────────
const input       = document.getElementById('jsonInput');
const preview     = document.getElementById('preview');
const inputLines  = document.getElementById('inputLines');
const previewLines= document.getElementById('previewLines');
const copyBtn     = document.getElementById('copyBtn');
const clearBtn    = document.getElementById('clearBtn');

let currentData = null;

// ─── Helpers ───────────────────────────────────────
function escape(s) {
  return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'} [m]));
}

function countLines(str) {
  return (str.match(/\n/g) || []).length + (str ? 1 : 0);
}

function syncLines(source, linesEl) {
  if (!source) return;
  const text = source.value || source.textContent || '';
  const count = countLines(text);
  let html = '';
  for(let i = 1; i <= count; i++) html += i + '\n';
  linesEl.textContent = html;
  linesEl.scrollTop = source.scrollTop;
}

// ─── Node renderer ──────────────────────────────────
function createNode(value, isLast = true, depth = 0) {
  const container = document.createElement('div');
  container.className = 'node';

  // ── Primitives ────────────────────────────────────
  if (value === null || typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
    const row = document.createElement('div');
    row.className = 'header-row';

    const content = document.createElement('span');
    if (value === null) {
      content.className = 'null';
      content.textContent = 'null';
    } else if (typeof value === 'string') {
      content.className = 'string';
      content.textContent = `"${escape(value)}"`;
    } else if (typeof value === 'number') {
      content.className = 'number';
      content.textContent = value;
    } else {
      content.className = 'boolean';
      content.textContent = value;
    }

    row.appendChild(content);

    if (!isLast) {
      const comma = document.createElement('span');
      comma.className = 'comma';
      comma.textContent = ',';
      row.appendChild(comma);
    }

    container.appendChild(row);
    return container;
  }

  // ── Objects & Arrays ──────────────────────────────
  const isArray = Array.isArray(value);
  const isEmpty = isArray ? value.length === 0 : Object.keys(value).length === 0;

  const header = document.createElement('div');
  header.className = 'header-row';

  const toggle = document.createElement('span');
  toggle.className = 'toggle';
  toggle.textContent = isEmpty ? '' : '▾';

  const openBrace = document.createElement('span');
  openBrace.className = 'brace';
  openBrace.textContent = isArray ? '[' : '{';

  const ellipsis = document.createElement('span');
  ellipsis.className = 'ellipsis';
  ellipsis.textContent = '…';

  const closeBrace = document.createElement('span');
  closeBrace.className = 'brace';
  closeBrace.textContent = isArray ? ']' : '}';

  if (!isLast) {
    const comma = document.createElement('span');
    comma.className = 'comma';
    comma.textContent = ',';
    closeBrace.appendChild(comma);
  }

  header.append(toggle, openBrace);

  const children = document.createElement('div');
  children.className = 'node-children';

  if (isEmpty) {
    header.appendChild(closeBrace);
  } else {
    header.append(ellipsis, closeBrace);

    if (isArray) {
      value.forEach((item, i) => {
        const child = createNode(item, i === value.length - 1, depth + 1);
        children.appendChild(child);
      });
    } else {
      const entries = Object.entries(value);
      entries.forEach(([key, val], i) => {
        const line = document.createElement('div');
        line.className = 'header-row';

        const keySpan = document.createElement('span');
        keySpan.className = 'key';
        keySpan.textContent = `"${escape(key)}": `;

        const valueNode = createNode(val, i === entries.length - 1, depth + 1);

        line.append(keySpan, valueNode);
        children.appendChild(line);
      });
    }
  }

  toggle.onclick = (e) => {
    e.stopPropagation();
    if (isEmpty) return;
    container.classList.toggle('collapsed');
    toggle.textContent = container.classList.contains('collapsed') ? '▸' : '▾';
    syncLines(null, previewLines);
  };

  // Root expanded, nested collapsed
  if (depth === 0) {
    container.classList.remove('collapsed');
    toggle.textContent = isEmpty ? '' : '▾';
  } else {
    container.classList.add('collapsed');
    toggle.textContent = isEmpty ? '' : '▸';
  }

  container.appendChild(header);
  if (!isEmpty) container.appendChild(children);

  return container;
}

function renderPreview() {
  const txt = input.value.trim();
  if (!txt) {
    preview.innerHTML = '<div class="empty">Paste JSON to see formatted preview</div>';
    syncLines(null, previewLines);
    currentData = null;
    return;
  }

  try {
    const data = JSON.parse(txt);
    currentData = data;

    preview.innerHTML = '';
    preview.appendChild(createNode(data, true, 0));

    syncLines(null, previewLines);
  } catch (err) {
    preview.innerHTML = `<div class="error-msg">Invalid JSON<br>${err.message}</div>`;
    currentData = null;
    syncLines(null, previewLines);
  }
}

// ─── Events ─────────────────────────────────────────
input.addEventListener('input', () => {
  syncLines(input, inputLines);
  renderPreview();
});

input.addEventListener('scroll', () => syncLines(input, inputLines));
preview.addEventListener('scroll', () => syncLines(preview, previewLines));

copyBtn.addEventListener('click', async () => {
  if (!currentData) return alert('No valid JSON');
  const pretty = JSON.stringify(currentData, null, 2);
  await navigator.clipboard.writeText(pretty).catch(console.error);
  copyBtn.textContent = 'Copied!';
  setTimeout(() => copyBtn.textContent = 'Copy Preview', 1400);
});

clearBtn.addEventListener('click', () => {
  input.value = '';
  preview.innerHTML = '<div class="empty">Paste JSON to see formatted preview</div>';
  syncLines(input, inputLines);
  syncLines(null, previewLines);
});

// Init
syncLines(input, inputLines);
renderPreview();

</script>
</body>
</html>
